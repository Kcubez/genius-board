generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// User profile
model User {
  id            String    @id @default(cuid())
  email         String    @unique
  passwordHash  String    // Hashed password
  name          String?
  isAdmin       Boolean   @default(false)  // Only one admin account
  isActive      Boolean   @default(true)
  startDate     DateTime?  // Account start date (null = immediately active)
  endDate       DateTime?  // Account end date (null = no expiry)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  @@index([email])
  @@index([isAdmin])
}

// Existing: Saved dashboard configurations
model SavedDashboard {
  id          String   @id @default(cuid())
  name        String
  description String?
  datasetId   String?  // Link to a specific dataset
  filters     Json
  chartConfig Json
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

// Existing: Temporary upload sessions (legacy)
model UploadSession {
  id        String   @id
  fileName  String
  columns   Json
  data      Json
  rowCount  Int      @default(0)
  createdAt DateTime @default(now())
  expiresAt DateTime

  @@index([expiresAt])
}

// NEW: Dataset - represents an uploaded CSV/Excel file
model Dataset {
  id          String    @id @default(cuid())
  userId      String    // Supabase Auth user ID
  name        String    // User-friendly name like "January Sales 2024"
  fileName    String    // Original file name "sales-jan.csv"
  columns     Json      // Column metadata: [{"name":"Date","type":"date"}, ...]
  rowCount    Int       @default(0)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  
  // Relation to data rows
  rows        DataRow[]
  
  @@index([userId])
  @@index([createdAt])
}

// NEW: DataRow - individual rows of data (stored as JSONB)
model DataRow {
  id          String    @id @default(cuid())
  datasetId   String
  rowIndex    Int       // For ordering rows
  data        Json      // Row data: {"Date":"2024-01-01","Customer":"Aung","Amount":5000}
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  
  // Relation to dataset
  dataset     Dataset   @relation(fields: [datasetId], references: [id], onDelete: Cascade)
  
  @@index([datasetId])
  @@index([datasetId, rowIndex])
}

// NEW: Feedback - user feedback and feature requests
model Feedback {
  id          String    @id @default(cuid())
  userId      String?   // User ID (null for anonymous)
  userEmail   String?   // User email (for convenience)
  type        String    @default("general") // feature_inquiry, feature_request, bug_report, general
  message     String    // User's message
  response    String?   // Admin's response
  status      String    @default("pending") // pending, reviewed, resolved
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  
  @@index([status])
  @@index([type])
  @@index([userId])
  @@index([createdAt])
}
